# 고유 노드 ID (서버 별로 유일해야 함)
node.id={{ ansible_play_hosts.index(inventory_hostname) }}

# 이 노드가 수행할 역할 (KRaft 모드에서는 보통 controller, broker)
process.roles={{ kafka_process_roles }}

# 컨트롤러 투표 대상 정의 (IP와 포트 조합)
controller.quorum.voters={% for host in groups['kafka'] %}{{ loop.index0 }}@{{ hostvars[host]['private_ip'] }}:{{ kafka_controller_port }}{% if not loop.last %},{% endif %}{% endfor %}

# Kafka 리스너 정의 (브로커 통신 / 컨트롤러 통신)
listeners=PLAINTEXT://{{ private_ip }}:{{ kafka_broker_port }},CONTROLLER://{{ private_ip }}:{{ kafka_controller_port }}
inter.broker.listener.name={{ kafka_inter_broker_listener }}
listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
controller.listener.names=CONTROLLER

# 클라이언트에게 광고할 리스너 주소 (외부 접속용)
advertised.listeners=PLAINTEXT://{{ public_ip }}:{{ kafka_broker_port }}

# 로그 저장 위치
log.dirs={{ kafka_log_dirs }}

# 네트워크 I/O 처리 스레드 수
num.network.threads={{ kafka_num_network_threads }}

# 디스크 I/O 처리 스레드 수
num.io.threads={{ kafka_num_io_threads }}

# 리플리카 데이터 복제용 스레드 수
num.replica.fetchers={{ kafka_num_replica_fetchers }}

# 로그 세그먼트 최대 크기 (byte 단위, 기본 1GB = 1073741824)
log.segment.bytes={{ kafka_log_segment_bytes }}

# 로그 보관 시간 (시간 단위, 기본 168시간 = 7일)
log.retention.hours={{ kafka_log_retention_hours }}

# retention 정책 검사 주기 (ms)
log.retention.check.interval.ms={{ kafka_log_retention_check_interval_ms }}

# 최대 메시지 크기
message.max.bytes={{ kafka_message_max_bytes }}

# 자동 토픽 생성 여부
auto.create.topics.enable={{ kafka_auto_create_topics | lower }}

# 토픽 삭제 허용 여부
delete.topic.enable={{ kafka_delete_topic_enable | lower }}

# 리더 선출 시 데이터 손실 허용 여부 (false 추천)
unclean.leader.election.enable={{ kafka_unclean_leader_election_enable | lower }}
